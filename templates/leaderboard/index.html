{% extends 'base.html' %}

{% block title %}Leaderboard | R.I.T.H.M{% endblock %}
{% block meta_description %}See the top music theory learners on R.I.T.H.M. Compare your scores and compete for the top spots!{% endblock %}

{% block content %}

<style>
  .leaderboard-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  .leaderboard-header {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .leaderboard-header h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }
  
  /* Game Tabs */
  .game-tabs {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }
  
  .game-tab {
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    border: 2px solid var(--border-color);
    background: transparent;
    color: var(--text-secondary);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
  }
  
  .game-tab:hover {
    border-color: var(--primary);
    color: var(--text-primary);
    text-decoration: none;
  }
  
  .game-tab.active {
    background: var(--primary);
    border-color: var(--primary);
    color: var(--text-primary);
  }
  
  /* Difficulty Toggle */
  .difficulty-toggle {
    display: flex;
    justify-content: center;
    gap: 0;
    margin-bottom: 1.5rem;
  }
  
  .difficulty-btn {
    padding: 0.6rem 1.25rem;
    border: 1px solid var(--border-color);
    background: transparent;
    color: var(--text-secondary);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    margin: 0;
  }
  
  .difficulty-btn:first-child {
    border-radius: 8px 0 0 8px;
  }
  
  .difficulty-btn:last-child {
    border-radius: 0 8px 8px 0;
  }
  
  .difficulty-btn:not(:last-child) {
    border-right: none;
  }
  
  .difficulty-btn:hover {
    background: var(--input-bg);
    color: var(--text-primary);
    text-decoration: none;
  }
  
  .difficulty-btn.active {
    background: var(--secondary);
    border-color: var(--secondary);
    color: var(--text-primary);
  }
  
  /* Period Toggle */
  .period-toggle {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
  }
  
  .period-btn {
    padding: 0.5rem 1.25rem;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background: transparent;
    color: var(--text-secondary);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
  }
  
  .period-btn:hover {
    background: var(--input-bg);
    color: var(--text-primary);
    text-decoration: none;
  }
  
  .period-btn.active {
    background: var(--input-bg);
    border-color: var(--text-muted);
    color: var(--text-primary);
  }
  
  /* Leaderboard Table */
  .leaderboard-card {
    background: var(--bg-card);
    backdrop-filter: blur(12px);
    border: 1px solid var(--input-bg);
    border-radius: 20px;
    overflow: hidden;
  }
  
  .leaderboard-table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .leaderboard-table th {
    text-align: left;
    padding: 1rem 1.5rem;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    border-bottom: 1px solid var(--input-bg);
  }
  
  .leaderboard-table td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
  }
  
  .leaderboard-table tr:last-child td {
    border-bottom: none;
  }
  
  .leaderboard-table tr:hover {
    background: var(--border-color);
  }
  
  .leaderboard-table tr.current-user {
    background: rgba(99, 102, 241, 0.15);
  }
  
  .leaderboard-table tr.current-user:hover {
    background: rgba(99, 102, 241, 0.2);
  }
  
  /* Rank Badges */
  .rank {
    font-family: 'Space Grotesk', sans-serif;
    font-weight: 700;
    font-size: 1.1rem;
    width: 40px;
    display: inline-block;
    text-align: center;
  }
  
  .rank-1 { color: #fbbf24; }
  .rank-2 { color: #94a3b8; }
  .rank-3 { color: #cd7f32; }
  
  .rank-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 0.9rem;
  }
  
  .rank-1 .rank-badge { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #1e293b; }
  .rank-2 .rank-badge { background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%); color: #1e293b; }
  .rank-3 .rank-badge { background: linear-gradient(135deg, #cd7f32 0%, #b8860b 100%); color: var(--text-primary); }
  
  .username {
    font-weight: 600;
    color: var(--text-primary);
  }
  
  .stat {
    font-family: 'Space Grotesk', sans-serif;
    color: var(--text-primary);
  }
  
  .stat-label {
    font-size: 0.75rem;
    color: var(--text-muted);
  }
  
  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-secondary);
  }
  
  .empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }
  
  /* User Rank Card */
  .user-rank-card {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    text-align: center;
  }
  
  .user-rank-card h3 {
    margin-bottom: 0.5rem;
    font-size: 1rem;
    color: var(--text-secondary);
  }
  
  .user-rank-number {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 3rem;
    font-weight: 700;
    color: var(--primary);
  }
  
  @media (max-width: 768px) {
    .leaderboard-table th,
    .leaderboard-table td {
      padding: 0.75rem 1rem;
    }
    
    .hide-mobile {
      display: none;
    }
  }
</style>

<div class="leaderboard-container">
  <div class="leaderboard-header">
    <h1 class="gradient-text"><i class="fas fa-trophy"></i> Leaderboard</h1>
    <p style="color: var(--text-secondary);">See how you rank against other learners</p>
  </div>
  
  <!-- Game Tabs -->
  <div class="game-tabs">
    {% for game in games %}
    <a href="?game={{ game.id }}&difficulty={{ current_difficulty }}&period={{ period }}" 
       class="game-tab {% if current_game == game.id %}active{% endif %}">
      <i class="fas {{ game.icon }}"></i> {{ game.name }}
    </a>
    {% endfor %}
  </div>
  
  <!-- Difficulty Toggle -->
  <div class="difficulty-toggle">
    {% for diff in difficulties %}
    <a href="?game={{ current_game }}&difficulty={{ diff.id }}&period={{ period }}" 
       class="difficulty-btn {% if current_difficulty == diff.id %}active{% endif %}">
      <i class="fas {{ diff.icon }}"></i> {{ diff.name }}
    </a>
    {% endfor %}
  </div>
  
  <!-- Period Toggle -->
  <div class="period-toggle">
    <a href="?game={{ current_game }}&difficulty={{ current_difficulty }}&period=alltime" 
       class="period-btn {% if period == 'alltime' %}active{% endif %}">
      All Time
    </a>
    <a href="?game={{ current_game }}&difficulty={{ current_difficulty }}&period=weekly" 
       class="period-btn {% if period == 'weekly' %}active{% endif %}">
      This Week
    </a>
  </div>
  
  <!-- User's Rank (if logged in and ranked) -->
  {% if user_rank %}
  <div class="user-rank-card">
    <h3>Your Rank</h3>
    <div class="user-rank-number">#{{ user_rank.rank }}</div>
    <p style="color: var(--text-secondary); margin: 0;">
      {{ user_rank.correct }} correct Â· {{ user_rank.accuracy }}% accuracy
    </p>
  </div>
  {% endif %}
  
  <!-- Leaderboard Table -->
  <div class="leaderboard-card">
    {% if leaderboard %}
    <table class="leaderboard-table">
      <thead>
        <tr>
          <th style="width: 60px;">Rank</th>
          <th>Player</th>
          <th style="text-align: right;">Correct</th>
          <th style="text-align: right;">Accuracy</th>
          <th style="text-align: right;" class="hide-mobile">Best Streak</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in leaderboard %}
        <tr class="{% if user.username == entry.username %}current-user{% endif %}">
          <td>
            <span class="rank rank-{{ entry.rank }}">
              {% if entry.rank <= 3 %}
              <span class="rank-badge">{{ entry.rank }}</span>
              {% else %}
              {{ entry.rank }}
              {% endif %}
            </span>
          </td>
          <td class="username">
            {{ entry.username }}
            {% if user.username == entry.username %}
            <span style="color: var(--primary); font-size: 0.8rem;">(you)</span>
            {% endif %}
          </td>
          <td style="text-align: right;">
            <span class="stat">{{ entry.correct }}</span>
          </td>
          <td style="text-align: right;">
            <span class="stat">{{ entry.accuracy }}%</span>
          </td>
          <td style="text-align: right;" class="hide-mobile">
            <span class="stat">{{ entry.best_streak }} <i class="fas fa-fire" style="color: #f59e0b; font-size: 0.8rem;"></i></span>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="empty-state">
      <i class="fas fa-trophy"></i>
      <h3>No scores yet!</h3>
      <p>Be the first to play and claim the top spot.</p>
      <a href="/{{ current_game }}_identification/" class="btn btn-primary" style="margin-top: 1rem;">
        <i class="fas fa-play"></i> Start Playing
      </a>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}
